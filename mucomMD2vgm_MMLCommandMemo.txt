mucomMD2vgm MMLコマンドメモ
元ネタ: MUSIC LALF MMLコマンドメモ


■ .vgmファイル作成手順

  1. 元になるMMLファイルを作成します。
    (1) mucomMD2vgmでは拡張子を便宜上.muMとします。(以下MMLファイルのことを.muMと略します。)
    (2) 文字コードはshiftJIS(改行はCRLF)とします。
    (3) .mucファイル(mucom88win向けMMLファイル)も使用できます。(制限あり)
  

  2-A. mucomMD2vgm.exeを使用する場合
    主にGUIでの使用を想定したプログラムです。ファイル監視と自動起動、vgz変換が可能。

    画面上のボタンの説明(左から)
      ・ファイルを開く
        .muM又は.mucファイルを読み込みます。
        読み込んだら即コンパイルを開始します。

      ・コンパイル
        一度読み込んだ.muMファイルを再コンパイルします。

      ・プレイヤーの自動起動(トグルボタン)
        コンパイル後に生成されたvgmを既定のプログラムで開きます。
        予め、vgmファイルに対して関連付けを行っておく必要があります。

      ・ファイルの更新監視(トグルボタン)
        一度読み込んだ.muMファイルの監視を開始します。
        更新を検出すると自動的にコンパイルを実行します。
        テキストエディタでmmlを変更し上書き保存した際に自動的にコンパイルさせることを想定した機能です。
        
      ・vgzファイル作成(トグルボタン)
        コンパイル時に生成したvgmファイルを自動的にvgzに変換します。

      ・Lコマンド解析処理拡張(トグルボタン)
        mucom88本来のLコマンドの動作をできるだけvgmで再現するモードになります。

      ・最大レンダリング時間指定(テキストボックス)
        Lコマンド解析処理拡張ボタンを有効にして処理を行ったとき、演奏時間を秒数で指定します。
		データ中のLコマンドの指定の仕方によっては、長時間の演奏が必要なパターンがあるためです。

    画面上の左ペインの説明
      コンパイル後のクロックカウンター値をリスト表示するペインです。
      ・Part
        コンパイルを行うと、パート名(AからKまで)が表示されます。
      ・Chip
        OPN2(YM2612)かDCSG(SN76489)が表示されます。
      ・Counter
        パートごとのクロックカウンター値が表示されます。
        Lコマンドを使用してループさせたい時は、この値が全パートで一致しているか確認すると便利です。

    画面上の右ペインの説明
      コンパイルの進捗、コンパイル時のエラーや警告など、詳細を表示します。


    他の使い方
      エクスプローラなどで、mucomMD2vgm.exeのアイコンの上に作成したMMLファイルをD&Dするとそれをコンパイルします。
      又は、コマンドラインから「mucomMD2vgm.exe ファイル名」と打ち込んでもそのファイルをコンパイルします。

  
  2-B. mdvc.exeを使用する場合
    mdvc.exeはコマンドプロンプト専用のプログラムです。
    コンパイル対象のmuMファイルをコマンドラインで指定し実行します。
    vgz変換が可能。

  
  3. コンパイルが実行され、エラーやワーニング、例外が表示される。
    又は、エラー無く無事に.vgmファイルが.muMと同じフォルダーに生成される。
  

  4. 手頃なvgmプレイヤーで試聴する。修正が必要であれば1から繰り返す。
  

  5. 完成！悦に入る。


■ 基本的な記述方法

  .muMは.mucファイルと記述方法は基本、同じです。
  (.mucファイルもそのまま使用できます。)


■ mucom88との違い

  ・対象音源
    mucom88     -> OPNA(YM2608)
    mucomMD2vgm -> OPN2(YM2612),DCSG(SN76489)

  ・パート割り
    A  OPN2(YM2612)  Ch.1
    B  OPN2(YM2612)  Ch.2
    C  OPN2(YM2612)  Ch.3
    D  DCSG(SN76489) Ch.1
    E  DCSG(SN76489) Ch.2
    F  DCSG(SN76489) Ch.3
    G  DCSG(SN76489) Ch.4(noise Ch)
    H  OPN2(YM2612)  Ch.4
    I  OPN2(YM2612)  Ch.5
    J  OPN2(YM2612)  Ch.6(FM向け)
    K  OPN2(YM2612)  Ch.6(PCM向け)

    JとKは排他的に使用します。片方がキーオン(発音)するともう片方の音は消えます

  ・コマンド
    mucom88と基本的には同じです。v1.7のコマンドにあわせています。
    違いは以下の通りです。

   v  ボリュームコマンド（リズム）
      mucom88のリズムパートで使用できる形式に未対応です。

   L  曲全体ループコマンド
      Lコマンド解析処理通常モード
        Aパート以外のLは無視されます。
        またvgmファイルの制約によりパートごとに長さが異なっていても、全パートは一番長いパートにパディング（
        休符で埋められるイメージです）されます。
	  Lコマンド解析処理拡張モード
	    mucom88と同じ演奏になるよう、全てのパートのLコマンドを考慮したvgmを作成します。

   P  ミキサモードコマンド
      Gパート(DCSG Ch.4)にて使用します。
	  以下の値を設定することによって動作モードが切り替わります。
      (注意：@コマンドで指定するエンベローププリセットパターン中のPコマンドは無視されます。)
        値      mode          rate  
        P0  ->  periodic      0
        P1  ->  periodic      1
        P2  ->  periodic      2
        P3  ->  periodic      Ch.3連動
        P4  ->  white noise   0
        P5  ->  white noise   1
        P6  ->  white noise   2
        P7  ->  white noise   Ch.3連動

      periodic    : ファミコンにちょっと似ている音がなります。
                    音域はかなり狭いですが、連動モードにてメロディを演奏することも可能です。

      white noise : 所謂、ノイズを発音します。
                    もっぱらエンベロープと組み合わせてリズムを刻むような使い方をします。

      Ch.3連動    : DCSGはノイズの周波数をCh.3(mucomMDではFチャンネル)を利用して設定します。
                    例えばo4aとFチャンネルで指定すればそれに応じたノイズ周波数がセットされます。
                    連動してしまうので当然使いにくいことが多いです。
                    潔くFチャンネルのボリュームを0にしてしまうとか、
                    通常は連動機能は使わず固定レートを使用し「ここぞ」というときに連動させるなど、
                    何か工夫が必要になります。


   w  ノイズ周波数コマンド
      未対応です。(Ch.3の周波数を数値で指定できるようにしてもいいのかも。。。)

   vm PCMボリュームモードコマンド
      未対応です。


  ・タグ
    mucom88winと基本的には同じです。タグ名は大文字小文字を区別しません。
    (mucomMD2vgmではvgmの仕様に沿ってGD3形式に変換されます。意味の近いタグに置き換えます)
    違いは以下の通りです。

   #pcm filename
               ADPCM指定タグ
               mucom88形式のADPCMファイルをfilenameに指定します。
               muMファイルと同じパスを参照します。
               (mucomMD2vgmでは内部でPCM形式に変換します。)

   #PcmVolume n
               PCMの音量設定タグ
               設定値nは10進数の数値。範囲は0から255。初期値は255。
               ADPCMからPCMに変換する際の音量を設定します。
               255で最大音量になります。
               この設定の対象は#pcmのみです。

   '@ Pn,"filename"
               PCM個別設定
               n には音色番号、filenameにはwavファイル名を指定します。
               muMファイルと同じパスを参照します。
               読み込めるwavファイルの形式は以下の通りです。
                8KHz , 8bit , mono , 圧縮なし , unsigned であること。
               8KHz固定で再生されます。
               #PcmVolumeの設定は無視されます。
               また、#pcmで定義されている内容が優先で使用されます。
               よって#pcmで定義されていない音色番号を指定するか、
               場合によっては#pcmの内容を削除する必要があります。


以上
